<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Contact Us - Smart Tiffin</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <!-- Custom CSS -->
    <style>
      :root {
        --primary-green: #2e8b57;
        --primary-light: #4caf7d;
        --secondary-teal: #20b2aa;
        --dark-color: #2d3748;
        --light-color: #f7fafc;
        --text-light: #718096;
        --border-light: #e2e8f0;
      }

      /* Global Styles */
      body {
        font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: var(--dark-color);
        padding-top: 76px; /* Add padding to prevent navbar overlap */
      }

      .section-padding {
        padding: 80px 0;
      }

      .section-title {
        font-size: 2.2rem;
        font-weight: 700;
        margin-bottom: 1rem;
        color: var(--dark-color);
      }

      .section-subtitle {
        font-size: 1.1rem;
        color: var(--text-light);
        margin-bottom: 3rem;
      }

      /* Navbar Styles */
      .navbar {
        padding: 1rem 0;
        transition: all 0.3s ease;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        background-color: white;
      }

      /* Refactored: Scrolled Navbar State using a class toggle in JS */
      .navbar.navbar-scrolled {
        padding: 0.5rem 0 !important;
        background: rgba(255, 255, 255, 0.95) !important;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
      }

      .navbar-brand {
        font-size: 1.6rem;
        font-weight: 700;
        color: var(--primary-green) !important;
      }

      .navbar-nav .nav-link {
        font-weight: 500;
        padding: 0.5rem 1rem;
        margin: 0 0.2rem;
        border-radius: 0.375rem;
        transition: all 0.3s ease;
        color: var(--dark-color) !important;
      }

      .navbar-nav .nav-link:hover {
        background-color: rgba(46, 139, 87, 0.1);
        color: var(--primary-green) !important;
      }

      .navbar-nav .nav-link.active {
        background-color: var(--primary-green);
        color: white !important;
      }

      .btn-login {
        border: 1px solid var(--primary-green);
        color: var(--primary-green);
        padding: 0.5rem 1.5rem;
        border-radius: 4px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .btn-login:hover {
        background-color: var(--primary-green);
        color: white;
      }

      .btn-signup {
        background-color: var(--primary-green);
        color: white;
        padding: 0.5rem 1.5rem;
        border-radius: 4px;
        font-weight: 500;
        transition: all 0.3s ease;
        border: none;
      }

      .btn-signup:hover {
        background-color: var(--primary-light);
      }

      /* Hero Section */
      .contact-hero {
        background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
          url("https://images.unsplash.com/photo-1557804506-669a67965ba0?ixlib=rb-4.0.3&auto=format&fit=crop&w=1950&q=80");
        background-size: cover;
        background-position: center;
        color: white;
        padding: 100px 0 80px;
        position: relative;
        text-align: center;
        margin-top: -76px; /* Compensate for body padding */
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
      }

      .contact-hero-title {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        line-height: 1.2;
      }

      .contact-hero-subtitle {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        opacity: 0.9;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
      }

      /* Contact Form Section */
      .contact-form-section {
        background-color: var(--light-color);
      }

      .contact-form-card {
        padding: 2.5rem;
        border-radius: 12px;
        background: white;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        height: 100%;
      }

      /* Contact Info Card - Re-purposed for horizontal display */
      .contact-info-card {
        padding: 1.5rem;
        border-radius: 12px;
        background: white;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        height: 100%;
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .contact-info-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      }

      .contact-icon {
        width: 50px; /* Smaller icon size for horizontal layout */
        height: 50px;
        background-color: rgba(46, 139, 87, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 0.75rem; /* Reduced margin */
        color: var(--primary-green);
        font-size: 1.4rem;
      }

      .form-control {
        padding: 0.8rem 1rem;
        border: 1px solid var(--border-light);
        border-radius: 8px;
        margin-bottom: 1.5rem;
        transition: all 0.3s ease;
      }

      .form-control:focus {
        border-color: var(--primary-green);
        box-shadow: 0 0 0 0.2rem rgba(46, 139, 87, 0.2);
      }

      .form-label {
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--dark-color);
      }

      .btn-submit {
        background-color: var(--primary-green);
        color: white;
        border: none;
        padding: 0.9rem 2.2rem;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 8px;
        width: 100%;
        transition: all 0.3s ease;
      }

      .btn-submit:hover {
        background-color: var(--primary-light);
        box-shadow: 0 4px 10px rgba(46, 139, 87, 0.4);
        transform: translateY(-2px);
      }

      /* Map Section */
      .map-section {
        background-color: white;
      }

      .map-container {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      }

      /* CTA Section */
      .cta-section {
        background-color: var(--primary-green);
        color: white;
        border-radius: 12px;
        margin-bottom: 40px;
      }

      .btn-cta {
        background-color: white;
        color: var(--primary-green);
        border: none;
        padding: 0.9rem 2.2rem;
        font-size: 1.1rem;
        font-weight: 600;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .btn-cta:hover {
        background-color: #f0f0f0;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      }

      /* Footer */
      footer {
        background-color: var(--dark-color);
        color: white;
      }

      .footer-social-links a {
        color: #a0aec0;
        font-size: 1.4rem;
        margin-right: 1.2rem;
        transition: color 0.3s ease;
      }

      .footer-social-links a:hover {
        color: var(--primary-light);
      }

      .text-white-50 a:hover {
        color: white !important;
      }

      /* Responsive */
      @media (max-width: 768px) {
        body {
          padding-top: 66px; /* Adjust for smaller navbar height */
        }

        .contact-hero {
          margin-top: -66px; /* Adjust for smaller navbar height */
          padding: 80px 0 60px;
        }

        .contact-hero-title {
          font-size: 2.2rem;
        }

        .section-title {
          font-size: 1.8rem;
        }

        .contact-form-card {
          padding: 1.5rem;
        }

        .contact-info-card {
          margin-bottom: 1rem;
        }
      }

      @media (max-width: 576px) {
        .contact-hero-title {
          font-size: 1.8rem;
        }

        .contact-hero-subtitle {
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
      <div class="container">
        <a class="navbar-brand" href="index.html">
          <i class="fas fa-utensils me-2"></i>Smart Tiffin
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About Us</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="plans.html">Meal Plans</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="how-it-works.html">How It Works</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="contact.html">Contact Us</a>
            </li>
          </ul>

          <div class="navbar-nav">
            <a class="nav-link btn btn-login me-2" href="login.html">Login</a>
            <a class="nav-link btn btn-signup" href="signup.html">Sign Up</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <section class="contact-hero">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-lg-10">
            <h1 class="contact-hero-title">Get in Touch with Us</h1>
            <p class="contact-hero-subtitle">
              We're here to help you with your orders, feedback, or any queries.
              Reach out to us and we'll get back to you as soon as possible.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Contact Form Section (With small info cards above the form) -->
    <section class="section-padding contact-form-section">
      <div class="container">
        <div class="row justify-content-center">
          <!-- Main Content Column -->
          <div class="col-lg-10" data-aos="fade-up">
            <!-- New: Small Contact Information Section (Above the form) -->
            <div class="row g-4 mb-5 text-center">
              <!-- Card 1: Phone -->
              <div class="col-md-4" data-aos="fade-up" data-aos-delay="100">
                <div class="contact-info-card">
                  <div class="contact-icon">
                    <i class="fas fa-phone"></i>
                  </div>
                  <h5 class="fw-bold">Call Us</h5>
                  <p class="mb-0 text-muted">+91 98765 43210</p>
                </div>
              </div>
              <!-- Card 2: Email -->
              <div class="col-md-4" data-aos="fade-up" data-aos-delay="200">
                <div class="contact-info-card">
                  <div class="contact-icon">
                    <i class="fas fa-envelope"></i>
                  </div>
                  <h5 class="fw-bold">Email Us</h5>
                  <p class="mb-0 text-muted">info@smarttiffin.com</p>
                </div>
              </div>
              <!-- Card 3: Address -->
              <div class="col-md-4" data-aos="fade-up" data-aos-delay="300">
                <div class="contact-info-card">
                  <div class="contact-icon">
                    <i class="fas fa-map-marker-alt"></i>
                  </div>
                  <h5 class="fw-bold">Find Us</h5>
                  <p class="mb-0 text-muted">Mumbai, Maharashtra, India</p>
                </div>
              </div>
            </div>

            <!-- Contact Form Card -->
            <div class="contact-form-card">
              <h2 class="section-title">Send Us a Message</h2>
              <p class="section-subtitle">
                Fill out the form below and we'll respond within 24 hours.
              </p>

              <!-- Custom Success Message Box (Replaces alert()) -->
              <div
                id="successMessage"
                class="alert alert-success d-none mb-4 shadow-sm"
                role="alert"
              >
                <strong>Success!</strong> Your message has been sent. We will
                contact you soon.
              </div>
              <!-- Error Message for LLM or general errors -->
              <div
                id="errorMessage"
                class="alert alert-danger d-none mb-4 shadow-sm"
                role="alert"
              >
                <strong>Oops!</strong> There was an issue processing your
                request. Please try again.
              </div>

              <form id="contactForm">
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="name" class="form-label">Full Name</label>
                      <input
                        type="text"
                        class="form-control"
                        id="name"
                        placeholder="Enter your full name"
                        required
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="email" class="form-label"
                        >Email Address</label
                      >
                      <input
                        type="email"
                        class="form-control"
                        id="email"
                        placeholder="Enter your email"
                        required
                      />
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="phone" class="form-label">Phone Number</label>
                      <input
                        type="tel"
                        class="form-control"
                        id="phone"
                        placeholder="Enter your phone number"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="subject" class="form-label">Subject</label>
                      <select class="form-control" id="subject" required>
                        <option value="" disabled selected>
                          Select a reason for contact
                        </option>
                        <option value="General Inquiry">General Inquiry</option>
                        <option value="Order Related">Order Related</option>
                        <option value="Feedback">Feedback</option>
                        <option value="Complaint">Complaint</option>
                        <option value="Partnership Opportunity">
                          Partnership Opportunity
                        </option>
                        <option value="Other">Other</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="mb-4">
                  <label for="message" class="form-label">Message</label>
                  <textarea
                    class="form-control"
                    id="message"
                    rows="5"
                    placeholder="Tell us how we can help you..."
                    required
                  ></textarea>
                  <!-- Gemini LLM Feature Button -->
                  <div class="d-flex justify-content-end mt-2">
                    <button
                      type="button"
                      class="btn btn-sm btn-outline-secondary"
                      id="refineMessageBtn"
                    >
                      <span
                        id="refineSpinner"
                        class="spinner-border spinner-border-sm d-none me-2"
                        role="status"
                        aria-hidden="true"
                      ></span>
                      âœ¨ Refine Message
                    </button>
                  </div>
                </div>

                <button type="submit" class="btn btn-submit">
                  Send Message
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Map Section -->
    <section class="section-padding map-section">
      <div class="container">
        <h2 class="section-title text-center" data-aos="fade-up">Find Us</h2>
        <p class="section-subtitle text-center" data-aos="fade-up">
          Visit our headquarters or reach out through any of our contact
          channels
        </p>

        <div class="row justify-content-center">
          <div class="col-lg-10" data-aos="fade-up">
            <div class="map-container">
              <!-- Added 'title' attribute for accessibility -->
              <iframe
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3771.902954895049!2d72.82245131538457!3d19.03366825874168!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3be7ced9c7d6b13b%3A0x1f2c3b4e5d6e7f8g!2sMumbai%2C%20Maharashtra!5e0!3m2!1sen!2sin!4v1641234567890!5m2!1sen!2sin"
                width="100%"
                height="400"
                style="border: 0"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
                title="Location of Smart Tiffin Headquarters in Mumbai"
              >
              </iframe>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <section class="section-padding cta-section">
      <div class="container">
        <div class="row justify-content-center text-center">
          <div class="col-lg-8" data-aos="fade-up">
            <h2 class="mb-4">Have questions? We're happy to help!</h2>
            <p class="mb-4">
              Our customer support team is available to assist you with any
              inquiries about our services, meal plans, or partnerships.
            </p>
            <a href="#contactForm" class="btn btn-cta">Contact Now</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="pt-5 pb-3">
      <div class="container">
        <div class="row">
          <div class="col-lg-4 mb-4">
            <h4 class="mb-3">
              <i class="fas fa-utensils me-2"></i>Smart Tiffin
            </h4>
            <p class="mb-3">
              Connecting homemakers with food lovers for healthy, affordable,
              and delicious home-cooked meals.
            </p>
            <div class="footer-social-links">
              <!-- Added target="_blank" for external links -->
              <a href="https://instagram.com" target="_blank"
                ><i class="fab fa-instagram"></i
              ></a>
              <a href="https://facebook.com" target="_blank"
                ><i class="fab fa-facebook"></i
              ></a>
              <a href="https://twitter.com" target="_blank"
                ><i class="fab fa-twitter"></i
              ></a>
              <a href="https://linkedin.com" target="_blank"
                ><i class="fab fa-linkedin"></i
              ></a>
              <a href="https://youtube.com" target="_blank"
                ><i class="fab fa-youtube"></i
              ></a>
            </div>
          </div>

          <div class="col-lg-2 mb-4">
            <h5 class="mb-3">Quick Links</h5>
            <ul class="list-unstyled">
              <li class="mb-2">
                <a href="index.html" class="text-white-50 text-decoration-none"
                  >Home</a
                >
              </li>
              <li class="mb-2">
                <a href="about.html" class="text-white-50 text-decoration-none"
                  >About Us</a
                >
              </li>
              <li class="mb-2">
                <a href="plans.html" class="text-white-50 text-decoration-none"
                  >Meal Plans</a
                >
              </li>
              <li class="mb-2">
                <a
                  href="how-it-works.html"
                  class="text-white-50 text-decoration-none"
                  >How It Works</a
                >
              </li>
              <li class="mb-2">
                <a
                  href="contact.html"
                  class="text-white-50 text-decoration-none"
                  >Contact</a
                >
              </li>
            </ul>
          </div>

          <div class="col-lg-3 mb-4">
            <h5 class="mb-3">Support</h5>
            <ul class="list-unstyled">
              <li class="mb-2">
                <a href="#" class="text-white-50 text-decoration-none"
                  >Help Center</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-white-50 text-decoration-none"
                  >Privacy Policy</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-white-50 text-decoration-none"
                  >Terms of Service</a
                >
              </li>
              <li class="mb-2">
                <a href="#" class="text-white-50 text-decoration-none">FAQ</a>
              </li>
            </ul>
          </div>

          <div class="col-lg-3 mb-4">
            <h5 class="mb-3">Contact Info</h5>
            <ul class="list-unstyled">
              <li class="mb-2">
                <i class="fas fa-envelope me-2"></i>info@smarttiffin.com
              </li>
              <li class="mb-2">
                <i class="fas fa-phone me-2"></i>+91 98765 43210
              </li>
              <li class="mb-2">
                <i class="fas fa-map-marker-alt me-2"></i>Mumbai, India
              </li>
            </ul>
          </div>
        </div>

        <hr class="bg-white" />

        <div class="row">
          <div class="col-md-6">
            <p class="mb-0">&copy; 2025 Smart Tiffin. All rights reserved.</p>
          </div>
          <div class="col-md-6 text-md-end">
            <p class="mb-0">Powered by VIP Tech Visionary</p>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap & JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- AOS Animation -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
      // Initialize AOS
      AOS.init({
        duration: 1000,
        once: true,
        offset: 100,
      });

      // Gemini API Configuration
      const API_URL =
        "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
      const API_KEY = ""; // Placeholder for Canvas environment

      // Function to display the custom success message (Replaces alert())
      function showSuccessMessage(name, email, subject) {
        const successBox = document.getElementById("successMessage");
        const errorBox = document.getElementById("errorMessage");
        errorBox.classList.add("d-none");
        if (successBox) {
          successBox.innerHTML = `<strong>Success, ${name}!</strong> Your message has been sent successfully regarding your <strong>${subject}</strong>. We will contact you at ${email} within 24 hours.`;
          successBox.classList.remove("d-none");
          successBox.classList.add("d-block");

          // Hide the message after 5 seconds
          setTimeout(() => {
            successBox.classList.remove("d-block");
            successBox.classList.add("d-none");
          }, 5000);
        }
      }

      // Function to display an error message
      function showErrorMessage(message, isInfo = false) {
        const errorBox = document.getElementById("errorMessage");
        const successBox = document.getElementById("successMessage");

        errorBox.classList.remove("alert-danger", "alert-info");
        errorBox.classList.add(isInfo ? "alert-info" : "alert-danger");

        successBox.classList.add("d-none");
        if (errorBox) {
          errorBox.innerHTML = isInfo
            ? `<strong>Info:</strong> ${message}`
            : `<strong>Error:</strong> ${message}`;
          errorBox.classList.remove("d-none");
          errorBox.classList.add("d-block");

          // Hide the message after 5 seconds
          setTimeout(() => {
            errorBox.classList.remove("d-block");
            errorBox.classList.add("d-none");
          }, 5000);
        }
      }

      /**
       * Calls the Gemini API with exponential backoff for resilience.
       * @param {string} userQuery The user's prompt.
       * @param {string} systemPrompt The system instruction.
       * @param {number} maxRetries Maximum number of retries.
       * @returns {Promise<string>} The generated text.
       */
      async function callGeminiApi(userQuery, systemPrompt, maxRetries = 3) {
        const payload = {
          contents: [{ parts: [{ text: userQuery }] }],
          systemInstruction: { parts: [{ text: systemPrompt }] },
        };

        for (let attempt = 0; attempt < maxRetries; attempt++) {
          try {
            const response = await fetch(API_URL + API_KEY, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            if (!response.ok) {
              if (response.status === 429 && attempt < maxRetries - 1) {
                const delay = Math.pow(2, attempt) * 1000;
                await new Promise((resolve) => setTimeout(resolve, delay));
                continue; // Retry
              }
              throw new Error(
                `API call failed with status: ${response.status}`
              );
            }

            const result = await response.json();
            const generatedText =
              result?.candidates?.[0]?.content?.parts?.[0]?.text;

            if (!generatedText) {
              throw new Error("Received empty response from the model.");
            }

            return generatedText;
          } catch (error) {
            if (attempt === maxRetries - 1) {
              throw new Error(
                `Failed to call Gemini API after ${maxRetries} attempts: ${error.message}`
              );
            }
            // Backoff logic handled in the loop for 429, otherwise break on general error
          }
        }
        throw new Error("Gemini API call failed unexpectedly.");
      }

      document.addEventListener("DOMContentLoaded", function () {
        const navbar = document.querySelector(".navbar");
        const contactForm = document.getElementById("contactForm");
        const refineMessageBtn = document.getElementById("refineMessageBtn");
        const messageTextarea = document.getElementById("message");
        const refineSpinner = document.getElementById("refineSpinner");

        // 1. Navbar scroll effect
        window.addEventListener("scroll", () => {
          if (window.scrollY > 100) {
            navbar.classList.add("navbar-scrolled");
          } else {
            navbar.classList.remove("navbar-scrolled");
          }
        });

        // 2. Set active nav link
        const currentPage =
          window.location.pathname.split("/").pop() || "index.html";
        const navLinks = document.querySelectorAll(".nav-link");

        navLinks.forEach((link) => {
          if (link.getAttribute("href") === currentPage) {
            link.classList.add("active");
          } else {
            link.classList.remove("active");
          }
        });

        // 3. Form submission handler
        if (contactForm) {
          contactForm.addEventListener("submit", function (e) {
            e.preventDefault();

            // Get form values
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const subject = document.getElementById("subject").value;

            // Show custom success message (replacing the forbidden alert())
            showSuccessMessage(name, email, subject);

            // Reset form
            contactForm.reset();
          });
        }

        // 4. Gemini LLM Refine Message Feature Handler
        if (refineMessageBtn && messageTextarea) {
          refineMessageBtn.addEventListener("click", async () => {
            const originalMessage = messageTextarea.value.trim();

            if (originalMessage.length < 20) {
              showErrorMessage(
                "Please write a longer message (at least 20 characters) for the AI to refine."
              );
              return;
            }

            // Show loading state
            refineSpinner.classList.remove("d-none");
            refineMessageBtn.disabled = true;
            document.getElementById("errorMessage").classList.add("d-none"); // Hide previous errors

            const systemPrompt =
              "Act as a professional communications assistant for a food delivery service (Smart Tiffin). Refine the user's message, ensuring it is polite, concise, and clearly states the query or issue. Maintain the original intent. Output only the refined text, nothing else.";
            const userQuery = `Original message to refine: "${originalMessage}"`;

            try {
              const refinedText = await callGeminiApi(userQuery, systemPrompt);

              // Replace the message with the refined version
              messageTextarea.value = refinedText.trim();

              // Display success status
              showErrorMessage(
                "Message refined successfully. Review and send when ready.",
                true
              ); // true for alert-info styling
            } catch (error) {
              console.error("Gemini Refinement Error:", error);
              showErrorMessage(
                "Could not refine the message. Please check your text or send it as is."
              );
            } finally {
              // Hide loading state
              refineSpinner.classList.add("d-none");
              refineMessageBtn.disabled = false;
            }
          });
        }
      });
    </script>
  </body>
</html>
